import{j as e,u as k}from"./query-vendor-DbbwdUmu.js";import{r as u}from"./react-vendor-B9B04VyU.js";import{C as n,a as c,b as x,c as m}from"./card-CGlLgBal.js";import{B as v}from"./badge-6FZ8YVdM.js";import{S as w}from"./scroll-area-CHUc5UOG.js";import{f as b,g as D,l as R}from"./index-Dae1gTR_.js";import{u as M}from"./router-vendor-CIOyAg1L.js";import{y as _,k as g,h as O,z as W,u as F,t as U,s as Y}from"./ui-vendor-tvosxp_B.js";const q=D("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),y=u.forwardRef(({className:i,variant:l,...d},f)=>e.jsx("div",{ref:f,role:"alert",className:b(q({variant:l}),i),...d}));y.displayName="Alert";const C=u.forwardRef(({className:i,...l},d)=>e.jsx("h5",{ref:d,className:b("mb-1 font-medium leading-none tracking-tight",i),...l}));C.displayName="AlertTitle";const A=u.forwardRef(({className:i,...l},d)=>e.jsx("div",{ref:d,className:b("text-sm [&_p]:leading-relaxed",i),...l}));A.displayName="AlertDescription";function Z(){var N;const[i,l]=u.useState([]),[d,f]=u.useState(!1),{toast:j}=R(),[,T]=M(),p=t=>{switch(t){case"PROFANITY_ALERT":return{title:"Profanity Detected",icon:g,color:"destructive",badgeColor:"destructive",borderColor:"border-destructive/50",bgColor:"bg-destructive/5"};case"LANGUAGE_POLICY_ALERT":return{title:"Language Policy Violation",icon:Y,color:"orange",badgeColor:"outline",borderColor:"border-orange-500/50",bgColor:"bg-orange-500/5"};case"TOPIC_ADHERENCE_ALERT":return{title:"Off-Topic Content",icon:U,color:"yellow",badgeColor:"outline",borderColor:"border-yellow-500/50",bgColor:"bg-yellow-500/5"};case"PARTICIPATION_ALERT":return{title:"Participation Imbalance",icon:F,color:"blue",badgeColor:"outline",borderColor:"border-blue-500/50",bgColor:"bg-blue-500/5"};default:return{title:"Alert",icon:g,color:"destructive",badgeColor:"destructive",borderColor:"border-destructive/50",bgColor:"bg-destructive/5"}}},{data:r,isLoading:$,isError:E,error:L}=k({queryKey:["/api/dashboard/stats"],retry:!1});u.useEffect(()=>{const t=window.location.protocol==="https:"?"wss:":"ws:",a=new WebSocket(`${t}//${window.location.host}/ws/monitor`);return a.onopen=()=>{console.log("[Monitor] WebSocket connected"),f(!0)},a.onmessage=s=>{try{const o=JSON.parse(s.data);if(o.type==="CONNECTED"){console.log("[Monitor] Connected:",o.message);return}if(["PROFANITY_ALERT","LANGUAGE_POLICY_ALERT","TOPIC_ADHERENCE_ALERT","PARTICIPATION_ALERT"].includes(o.type)){const I={...o,timestamp:new Date().toISOString()};l(P=>[I,...P].slice(0,50));const h=p(o.type),G=h.icon;j({title:h.title,description:`${o.deviceName} - "${o.flaggedWord}" by ${o.speaker}`,variant:h.color==="destructive"?"destructive":"default"})}}catch(o){console.error("[Monitor] Parse error:",o)}},a.onclose=s=>{console.log("[Monitor] WebSocket closed:",s.code,s.reason),f(!1)},a.onerror=s=>{console.error("[Monitor] WebSocket error:",s),f(!1)},()=>{a.close()}},[j]);const S=t=>{const a=Math.floor(t/1e3),s=Math.floor(a/60),o=a%60;return`${s}:${o.toString().padStart(2,"0")}`};if($)return e.jsx("div",{className:"flex items-center justify-center h-full","data-testid":"loading-monitor",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-lg","data-testid":"text-loading-message",children:"Loading dashboard..."})})});if(E){const t=L,a=((N=t==null?void 0:t.response)==null?void 0:N.status)||(t==null?void 0:t.status),s=a===401||a===403;return e.jsx("div",{className:"flex items-center justify-center h-full p-8","data-testid":"error-monitor",children:e.jsxs(n,{className:"max-w-md",children:[e.jsx(c,{children:e.jsxs(x,{className:"flex items-center gap-2","data-testid":"text-error-title",children:[e.jsx(_,{className:"h-5 w-5 text-destructive"}),"Access Denied"]})}),e.jsxs(m,{children:[e.jsxs(y,{variant:"destructive","data-testid":"alert-unauthorized",children:[e.jsx(g,{className:"h-4 w-4"}),e.jsx(C,{"data-testid":"text-alert-title",children:s?"Admin Access Required":"Error Loading Dashboard"}),e.jsx(A,{"data-testid":"text-alert-description",children:s?"You do not have permission to access the admin monitoring dashboard. Please contact your administrator or login with an admin account.":"Failed to load dashboard data. Please try again later."})]}),e.jsxs("div",{className:"mt-4 flex gap-2",children:[e.jsx("button",{onClick:()=>T("/dashboard"),className:"text-sm text-primary hover:underline","data-testid":"button-back-to-dashboard",children:"â† Back to Dashboard"}),e.jsx("button",{onClick:()=>window.location.href="/api/logout",className:"text-sm text-muted-foreground hover:underline ml-auto","data-testid":"button-logout",children:"Logout"})]})]})]})})}return e.jsxs("div",{className:"flex flex-col h-full overflow-hidden","data-testid":"page-monitor",children:[e.jsx("div",{className:"border-b p-4",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-semibold","data-testid":"text-monitor-title",children:"Admin Monitoring Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground","data-testid":"text-monitor-subtitle",children:"Real-time content monitoring across all devices"})]}),e.jsx(v,{variant:d?"default":"destructive","data-testid":`badge-connection-${d?"connected":"disconnected"}`,children:d?"Connected":"Disconnected"})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 p-4",children:[e.jsxs(n,{"data-testid":"card-total-devices",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total Devices"}),e.jsx(O,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-total-devices",children:(r==null?void 0:r.totalDevices)||0})})]}),e.jsxs(n,{"data-testid":"card-total-sessions",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total Sessions"}),e.jsx(W,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsx(m,{children:e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-total-sessions",children:(r==null?void 0:r.totalSessions)||0})})]}),e.jsxs(n,{"data-testid":"card-total-profanity",children:[e.jsxs(c,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(x,{className:"text-sm font-medium",children:"Total Flags"}),e.jsx(g,{className:"h-4 w-4 text-muted-foreground"})]}),e.jsxs(m,{children:[e.jsx("div",{className:"text-2xl font-bold","data-testid":"text-total-profanity",children:(r==null?void 0:r.totalProfanity)||0}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"All flagged content"})]})]})]}),e.jsxs("div",{className:"flex-1 grid grid-cols-1 md:grid-cols-2 gap-4 p-4 overflow-hidden",children:[e.jsxs(n,{className:"flex flex-col overflow-hidden","data-testid":"card-device-list",children:[e.jsx(c,{children:e.jsx(x,{children:"Devices"})}),e.jsx(m,{className:"flex-1 overflow-hidden",children:e.jsx(w,{className:"h-full",children:e.jsx("div",{className:"space-y-2",children:r!=null&&r.devices&&r.devices.length>0?r.devices.map(t=>e.jsxs("div",{className:"flex items-center justify-between p-3 border rounded-md hover-elevate","data-testid":`device-item-${t.id}`,children:[e.jsxs("div",{children:[e.jsx("div",{className:"font-medium","data-testid":`text-device-name-${t.id}`,children:t.name}),e.jsxs("div",{className:"text-sm text-muted-foreground","data-testid":`text-device-sessions-${t.id}`,children:[t.totalSessions," sessions"]})]}),e.jsxs(v,{variant:t.totalProfanity>0?"destructive":"secondary","data-testid":`badge-profanity-${t.id}`,children:[t.totalProfanity," flags"]})]},t.id)):e.jsx("div",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-devices",children:"No devices found"})})})})]}),e.jsxs(n,{className:"flex flex-col overflow-hidden","data-testid":"card-alert-feed",children:[e.jsx(c,{children:e.jsx(x,{children:"Live Alert Feed"})}),e.jsx(m,{className:"flex-1 overflow-hidden",children:e.jsx(w,{className:"h-full",children:e.jsx("div",{className:"space-y-2",children:i.length>0?i.map((t,a)=>{const s=p(t.type),o=s.icon;return e.jsx("div",{className:`p-3 border rounded-md ${s.borderColor} ${s.bgColor}`,"data-testid":`alert-item-${a}`,children:e.jsxs("div",{className:"flex items-start justify-between gap-2",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1 flex-wrap",children:[e.jsx(o,{className:`h-4 w-4 flex-shrink-0 ${s.color==="destructive"?"text-destructive":s.color==="orange"?"text-orange-600":s.color==="yellow"?"text-yellow-600":"text-blue-600"}`}),e.jsx(v,{variant:s.badgeColor,className:s.color==="orange"?"border-orange-500 text-orange-700 bg-orange-50":s.color==="yellow"?"border-yellow-500 text-yellow-700 bg-yellow-50":s.color==="blue"?"border-blue-500 text-blue-700 bg-blue-50":"","data-testid":`badge-alert-type-${a}`,children:s.title}),e.jsx("span",{className:"font-medium truncate","data-testid":`text-alert-device-${a}`,children:t.deviceName})]}),e.jsxs("div",{className:"text-sm space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:"Speaker: "}),e.jsx("span",{"data-testid":`text-alert-speaker-${a}`,children:t.speaker}),e.jsx("span",{className:"text-muted-foreground",children:" at "}),e.jsx("span",{"data-testid":`text-alert-timestamp-${a}`,children:S(t.timestampMs)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-muted-foreground",children:t.flagType==="participation"?"Issue: ":"Word: "}),e.jsxs("span",{className:`font-semibold ${s.color==="destructive"?"text-destructive":s.color==="orange"?"text-orange-600":s.color==="yellow"?"text-yellow-600":"text-blue-600"}`,"data-testid":`text-alert-word-${a}`,children:['"',t.flaggedWord,'"']})]}),t.context&&e.jsxs("div",{className:"text-xs text-muted-foreground italic","data-testid":`text-alert-context-${a}`,children:["...",t.context,"..."]})]})]}),e.jsx("div",{className:"text-xs text-muted-foreground whitespace-nowrap","data-testid":`text-alert-createdAt-${a}`,children:new Date(t.timestamp).toLocaleTimeString()})]})},`${t.transcriptId}-${t.timestampMs}-${a}`)}):e.jsx("div",{className:"text-center text-muted-foreground py-8","data-testid":"text-no-alerts",children:d?"No alerts yet. Monitoring...":"Disconnected from alert feed"})})})})]})]})]})}export{Z as default};
