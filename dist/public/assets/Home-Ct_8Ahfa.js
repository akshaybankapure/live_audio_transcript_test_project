import{j as e,u as At}from"./query-vendor-DbbwdUmu.js";import{r as i}from"./react-vendor-B9B04VyU.js";import{u as Ft,T as De,S as Lt,a as Wt,b as zt,c as Kt,d as $t,R as Vt,h as Bt,e as Ut,F as Ht,f as ue,g as qt,i as Gt,j as Yt,k as Ne,l as ke}from"./transcripts-B6f3d0av.js";import{C as ee}from"./card-CGlLgBal.js";import{B as ie}from"./badge-6FZ8YVdM.js";import{F as Qt,d as Pe,P as Jt,e as Xt,T as Zt,X as es,M as fe,c as he,f as ts,g as ss}from"./ui-vendor-tvosxp_B.js";import{c as ns,a as Te,u as Me,b as K,d as G,P as V,e as rs,f as B,B as Z,g as as,h as be,D as os,i as is,j as cs,k as ls,l as Ie}from"./index-Dae1gTR_.js";import{u as ds,c as Oe,S as us}from"./scroll-area-CHUc5UOG.js";import"./router-vendor-CIOyAg1L.js";function ms({onFileSelect:t,selectedFile:n,onRemoveFile:s}){const r=i.useCallback(c=>{c.preventDefault(),c.stopPropagation()},[]),o=i.useCallback(c=>{c.preventDefault(),c.stopPropagation();const l=c.dataTransfer.files;if(l.length>0){const d=l[0];d.type.startsWith("audio/")&&t(d)}},[t]),a=i.useCallback(c=>{const l=c.target.files;l&&l.length>0&&t(l[0])},[t]);return n?e.jsx(ee,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"flex h-9 w-9 items-center justify-center rounded-md bg-primary/10",children:e.jsx(Qt,{className:"h-4 w-4 text-primary"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-medium truncate","data-testid":"text-filename",children:n.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[(n.size/1024/1024).toFixed(2)," MB"]})]}),s&&e.jsx("button",{onClick:s,className:"text-muted-foreground hover:text-foreground","data-testid":"button-remove-file",children:"Ã—"})]})}):e.jsx(ee,{className:"border-2 border-dashed hover-elevate cursor-pointer transition-colors",onDragOver:r,onDrop:o,"data-testid":"card-upload-zone",children:e.jsxs("label",{className:"flex flex-col items-center justify-center p-8 cursor-pointer",children:[e.jsx("input",{type:"file",accept:"audio/*",className:"hidden",onChange:a,"data-testid":"input-audio-file"}),e.jsx("div",{className:"flex h-12 w-12 items-center justify-center rounded-full bg-muted mb-3",children:e.jsx(Pe,{className:"h-6 w-6 text-muted-foreground"})}),e.jsx("p",{className:"text-sm font-medium mb-1",children:"Drop your audio file here or click to browse"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"Supports MP3, WAV, M4A files"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(ie,{variant:"secondary",className:"text-xs",children:"MP3"}),e.jsx(ie,{variant:"secondary",className:"text-xs",children:"WAV"}),e.jsx(ie,{variant:"secondary",className:"text-xs",children:"M4A"})]})]})})}var Ae=["PageUp","PageDown"],Fe=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],Le={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},re="Slider",[pe,fs,hs]=ns(re),[We,wn]=Te(re,[hs]),[ps,de]=We(re),ze=i.forwardRef((t,n)=>{const{name:s,min:r=0,max:o=100,step:a=1,orientation:c="horizontal",disabled:l=!1,minStepsBetweenThumbs:d=0,defaultValue:x=[r],value:v,onValueChange:u=()=>{},onValueCommit:p=()=>{},inverted:h=!1,form:_,...b}=t,m=i.useRef(new Set),S=i.useRef(0),C=c==="horizontal"?gs:xs,[y=[],P]=Me({prop:v,defaultProp:x,onChange:R=>{var W;(W=[...m.current][S.current])==null||W.focus(),u(R)}}),T=i.useRef(y);function D(R){const I=ws(y,R);M(R,I)}function L(R){M(R,S.current)}function O(){const R=T.current[S.current];y[S.current]!==R&&p(y)}function M(R,I,{commit:W}={commit:!1}){const se=Ns(a),U=ks(Math.round((R-r)/a)*a+r,se),Y=Oe(U,[r,o]);P((q=[])=>{const H=_s(q,Y,I);if(Rs(H,d*a)){S.current=H.indexOf(Y);const ae=String(H)!==String(q);return ae&&W&&p(H),ae?H:q}else return q})}return e.jsx(ps,{scope:t.__scopeSlider,name:s,disabled:l,min:r,max:o,valueIndexToChangeRef:S,thumbs:m.current,values:y,orientation:c,form:_,children:e.jsx(pe.Provider,{scope:t.__scopeSlider,children:e.jsx(pe.Slot,{scope:t.__scopeSlider,children:e.jsx(C,{"aria-disabled":l,"data-disabled":l?"":void 0,...b,ref:n,onPointerDown:K(b.onPointerDown,()=>{l||(T.current=y)}),min:r,max:o,inverted:h,onSlideStart:l?void 0:D,onSlideMove:l?void 0:L,onSlideEnd:l?void 0:O,onHomeKeyDown:()=>!l&&M(r,0,{commit:!0}),onEndKeyDown:()=>!l&&M(o,y.length-1,{commit:!0}),onStepKeyDown:({event:R,direction:I})=>{if(!l){const U=Ae.includes(R.key)||R.shiftKey&&Fe.includes(R.key)?10:1,Y=S.current,q=y[Y],H=a*U*I;M(q+H,Y,{commit:!0})}}})})})})});ze.displayName=re;var[Ke,$e]=We(re,{startEdge:"left",endEdge:"right",size:"width",direction:1}),gs=i.forwardRef((t,n)=>{const{min:s,max:r,dir:o,inverted:a,onSlideStart:c,onSlideMove:l,onSlideEnd:d,onStepKeyDown:x,...v}=t,[u,p]=i.useState(null),h=G(n,C=>p(C)),_=i.useRef(void 0),b=ds(o),m=b==="ltr",S=m&&!a||!m&&a;function z(C){const y=_.current||u.getBoundingClientRect(),P=[0,y.width],D=_e(P,S?[s,r]:[r,s]);return _.current=y,D(C-y.left)}return e.jsx(Ke,{scope:t.__scopeSlider,startEdge:S?"left":"right",endEdge:S?"right":"left",direction:S?1:-1,size:"width",children:e.jsx(Ve,{dir:b,"data-orientation":"horizontal",...v,ref:h,style:{...v.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:C=>{const y=z(C.clientX);c==null||c(y)},onSlideMove:C=>{const y=z(C.clientX);l==null||l(y)},onSlideEnd:()=>{_.current=void 0,d==null||d()},onStepKeyDown:C=>{const P=Le[S?"from-left":"from-right"].includes(C.key);x==null||x({event:C,direction:P?-1:1})}})})}),xs=i.forwardRef((t,n)=>{const{min:s,max:r,inverted:o,onSlideStart:a,onSlideMove:c,onSlideEnd:l,onStepKeyDown:d,...x}=t,v=i.useRef(null),u=G(n,v),p=i.useRef(void 0),h=!o;function _(b){const m=p.current||v.current.getBoundingClientRect(),S=[0,m.height],C=_e(S,h?[r,s]:[s,r]);return p.current=m,C(b-m.top)}return e.jsx(Ke,{scope:t.__scopeSlider,startEdge:h?"bottom":"top",endEdge:h?"top":"bottom",size:"height",direction:h?1:-1,children:e.jsx(Ve,{"data-orientation":"vertical",...x,ref:u,style:{...x.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:b=>{const m=_(b.clientY);a==null||a(m)},onSlideMove:b=>{const m=_(b.clientY);c==null||c(m)},onSlideEnd:()=>{p.current=void 0,l==null||l()},onStepKeyDown:b=>{const S=Le[h?"from-bottom":"from-top"].includes(b.key);d==null||d({event:b,direction:S?-1:1})}})})}),Ve=i.forwardRef((t,n)=>{const{__scopeSlider:s,onSlideStart:r,onSlideMove:o,onSlideEnd:a,onHomeKeyDown:c,onEndKeyDown:l,onStepKeyDown:d,...x}=t,v=de(re,s);return e.jsx(V.span,{...x,ref:n,onKeyDown:K(t.onKeyDown,u=>{u.key==="Home"?(c(u),u.preventDefault()):u.key==="End"?(l(u),u.preventDefault()):Ae.concat(Fe).includes(u.key)&&(d(u),u.preventDefault())}),onPointerDown:K(t.onPointerDown,u=>{const p=u.target;p.setPointerCapture(u.pointerId),u.preventDefault(),v.thumbs.has(p)?p.focus():r(u)}),onPointerMove:K(t.onPointerMove,u=>{u.target.hasPointerCapture(u.pointerId)&&o(u)}),onPointerUp:K(t.onPointerUp,u=>{const p=u.target;p.hasPointerCapture(u.pointerId)&&(p.releasePointerCapture(u.pointerId),a(u))})})}),Be="SliderTrack",Ue=i.forwardRef((t,n)=>{const{__scopeSlider:s,...r}=t,o=de(Be,s);return e.jsx(V.span,{"data-disabled":o.disabled?"":void 0,"data-orientation":o.orientation,...r,ref:n})});Ue.displayName=Be;var ge="SliderRange",He=i.forwardRef((t,n)=>{const{__scopeSlider:s,...r}=t,o=de(ge,s),a=$e(ge,s),c=i.useRef(null),l=G(n,c),d=o.values.length,x=o.values.map(p=>Ge(p,o.min,o.max)),v=d>1?Math.min(...x):0,u=100-Math.max(...x);return e.jsx(V.span,{"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,...r,ref:l,style:{...t.style,[a.startEdge]:v+"%",[a.endEdge]:u+"%"}})});He.displayName=ge;var xe="SliderThumb",qe=i.forwardRef((t,n)=>{const s=fs(t.__scopeSlider),[r,o]=i.useState(null),a=G(n,l=>o(l)),c=i.useMemo(()=>r?s().findIndex(l=>l.ref.current===r):-1,[s,r]);return e.jsx(vs,{...t,ref:a,index:c})}),vs=i.forwardRef((t,n)=>{const{__scopeSlider:s,index:r,name:o,...a}=t,c=de(xe,s),l=$e(xe,s),[d,x]=i.useState(null),v=G(n,z=>x(z)),u=d?c.form||!!d.closest("form"):!0,p=rs(d),h=c.values[r],_=h===void 0?0:Ge(h,c.min,c.max),b=Ss(r,c.values.length),m=p==null?void 0:p[l.size],S=m?js(m,_,l.direction):0;return i.useEffect(()=>{if(d)return c.thumbs.add(d),()=>{c.thumbs.delete(d)}},[d,c.thumbs]),e.jsxs("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[l.startEdge]:`calc(${_}% + ${S}px)`},children:[e.jsx(pe.ItemSlot,{scope:t.__scopeSlider,children:e.jsx(V.span,{role:"slider","aria-label":t["aria-label"]||b,"aria-valuemin":c.min,"aria-valuenow":h,"aria-valuemax":c.max,"aria-orientation":c.orientation,"data-orientation":c.orientation,"data-disabled":c.disabled?"":void 0,tabIndex:c.disabled?void 0:0,...a,ref:v,style:h===void 0?{display:"none"}:t.style,onFocus:K(t.onFocus,()=>{c.valueIndexToChangeRef.current=r})})}),u&&e.jsx(bs,{name:o??(c.name?c.name+(c.values.length>1?"[]":""):void 0),form:c.form,value:h},r)]})});qe.displayName=xe;var bs=t=>{const{value:n,...s}=t,r=i.useRef(null),o=Ft(n);return i.useEffect(()=>{const a=r.current,c=window.HTMLInputElement.prototype,d=Object.getOwnPropertyDescriptor(c,"value").set;if(o!==n&&d){const x=new Event("input",{bubbles:!0});d.call(a,n),a.dispatchEvent(x)}},[o,n]),e.jsx("input",{style:{display:"none"},...s,ref:r,defaultValue:n})};function _s(t=[],n,s){const r=[...t];return r[s]=n,r.sort((o,a)=>o-a)}function Ge(t,n,s){const a=100/(s-n)*(t-n);return Oe(a,[0,100])}function Ss(t,n){return n>2?`Value ${t+1} of ${n}`:n===2?["Minimum","Maximum"][t]:void 0}function ws(t,n){if(t.length===1)return 0;const s=t.map(o=>Math.abs(o-n)),r=Math.min(...s);return s.indexOf(r)}function js(t,n,s){const r=t/2,a=_e([0,50],[0,r]);return(r-a(n)*s)*s}function ys(t){return t.slice(0,-1).map((n,s)=>t[s+1]-n)}function Rs(t,n){if(n>0){const s=ys(t);return Math.min(...s)>=n}return!0}function _e(t,n){return s=>{if(t[0]===t[1]||n[0]===n[1])return n[0];const r=(n[1]-n[0])/(t[1]-t[0]);return n[0]+r*(s-t[0])}}function Ns(t){return(String(t).split(".")[1]||"").length}function ks(t,n){const s=Math.pow(10,n);return Math.round(t*s)/s}var Ye=ze,Cs=Ue,Es=He,Ds=qe;const Qe=i.forwardRef(({className:t,...n},s)=>e.jsxs(Ye,{ref:s,className:B("relative flex w-full touch-none select-none items-center",t),...n,children:[e.jsx(Cs,{className:"relative h-2 w-full grow overflow-hidden rounded-full bg-secondary",children:e.jsx(Es,{className:"absolute h-full bg-primary"})}),e.jsx(Ds,{className:"block h-5 w-5 rounded-full border-2 border-primary bg-background ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50"})]}));Qe.displayName=Ye.displayName;function Ps({audioUrl:t,onTimeUpdate:n,onDelete:s}){const r=i.useRef(null),[o,a]=i.useState(!1),[c,l]=i.useState(0),[d,x]=i.useState(0);i.useEffect(()=>{const h=r.current;if(!h)return;const _=()=>{const S=h.currentTime;l(S),n==null||n(S)},b=()=>{x(h.duration)},m=()=>{a(!1)};return h.addEventListener("timeupdate",_),h.addEventListener("loadedmetadata",b),h.addEventListener("ended",m),()=>{h.removeEventListener("timeupdate",_),h.removeEventListener("loadedmetadata",b),h.removeEventListener("ended",m)}},[n]);const v=()=>{const h=r.current;h&&(o?h.pause():h.play(),a(!o))},u=h=>{const _=r.current;if(!_)return;const b=h[0];_.currentTime=b,l(b)},p=h=>{if(!isFinite(h))return"00:00";const _=Math.floor(h/60),b=Math.floor(h%60);return`${_.toString().padStart(2,"0")}:${b.toString().padStart(2,"0")}`};return e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-card border border-card-border rounded-lg",children:[e.jsx("audio",{ref:r,src:t,preload:"metadata"}),e.jsx(Z,{size:"icon",variant:"default",onClick:v,"data-testid":"button-play-pause",className:"shrink-0",children:o?e.jsx(Jt,{className:"h-4 w-4"}):e.jsx(Xt,{className:"h-4 w-4"})}),e.jsxs("div",{className:"flex-1 flex items-center gap-3",children:[e.jsx(Qe,{value:[c],max:d||100,step:.1,onValueChange:u,className:"flex-1","data-testid":"slider-audio-progress"}),e.jsxs("span",{className:"text-sm font-mono text-muted-foreground min-w-[80px]","data-testid":"text-time",children:[p(c)," / ",p(d)]})]}),s&&e.jsx(Z,{size:"icon",variant:"ghost",onClick:s,"data-testid":"button-delete",className:"shrink-0",children:e.jsx(Zt,{className:"h-4 w-4"})})]})}const oe={},me=["blue","green","purple","amber","rose","cyan"];function Ts(t){if(!oe[t]){const n=Object.values(oe),s=me.filter(r=>!n.includes(r));oe[t]=s[0]||me[Object.keys(oe).length%me.length]}return oe[t]}function Ms({segments:t,currentTime:n=0,onSegmentClick:s,languages:r=[]}){const o=i.useRef(null),a=i.useRef(null),c=t.findIndex(l=>n>=l.startTime&&n<=l.endTime);return i.useEffect(()=>{a.current&&o.current&&a.current.scrollIntoView({behavior:"smooth",block:"center"})},[c]),t.length===0?e.jsx(ee,{className:"p-6",children:e.jsx("div",{className:"flex items-center justify-center h-96 text-muted-foreground",children:e.jsx("p",{className:"text-sm",children:"Upload an audio file to see the transcript"})})}):e.jsxs(ee,{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"p-4 border-b border-card-border flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Transcript"}),r.length>0&&e.jsx("div",{className:"flex gap-1","data-testid":"container-languages",children:r.map(l=>e.jsx(ie,{variant:"outline",className:"text-xs",children:l},l))})]}),e.jsx(us,{className:"flex-1",ref:o,children:e.jsx("div",{className:"p-6 space-y-3",children:t.map((l,d)=>e.jsx("div",{ref:d===c?a:null,children:e.jsx(De,{segment:l,isActive:d===c,onClick:()=>s==null?void 0:s(l),speakerColor:Ts(l.speaker)})},d))})})]})}var Is="Label",Je=i.forwardRef((t,n)=>e.jsx(V.label,{...t,ref:n,onMouseDown:s=>{var o;s.target.closest("button, input, select, textarea")||((o=t.onMouseDown)==null||o.call(t,s),!s.defaultPrevented&&s.detail>1&&s.preventDefault())}}));Je.displayName=Is;var Xe=Je;const Os=as("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ne=i.forwardRef(({className:t,...n},s)=>e.jsx(Xe,{ref:s,className:B(Os(),t),...n}));ne.displayName=Xe.displayName;const As=[{code:"auto",name:"Auto-detect"},{code:"en",name:"English"},{code:"es",name:"Spanish"},{code:"fr",name:"French"},{code:"de",name:"German"},{code:"pt",name:"Portuguese"},{code:"hi",name:"Hindi"},{code:"zh",name:"Chinese"},{code:"ja",name:"Japanese"},{code:"ko",name:"Korean"},{code:"ar",name:"Arabic"},{code:"ru",name:"Russian"},{code:"it",name:"Italian"}];function Ce({value:t,onChange:n}){return e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{className:"text-sm font-medium",children:"Transcription Language"}),e.jsxs(Lt,{value:t,onValueChange:n,children:[e.jsx(Wt,{"data-testid":"select-language",children:e.jsx(zt,{placeholder:"Select language"})}),e.jsx(Kt,{children:As.map(s=>e.jsx($t,{value:s.code,children:s.name},s.code))})]})]})}const ce=i.forwardRef(({className:t,type:n,...s},r)=>e.jsx("input",{type:n,className:B("flex h-9 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:r,...s}));ce.displayName="Input";const Ze=i.forwardRef(({className:t,...n},s)=>e.jsx("textarea",{className:B("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",t),ref:s,...n}));Ze.displayName="Textarea";var Se="Dialog",[et,jn]=Te(Se),[Fs,$]=et(Se),tt=t=>{const{__scopeDialog:n,children:s,open:r,defaultOpen:o,onOpenChange:a,modal:c=!0}=t,l=i.useRef(null),d=i.useRef(null),[x=!1,v]=Me({prop:r,defaultProp:o,onChange:a});return e.jsx(Fs,{scope:n,triggerRef:l,contentRef:d,contentId:ue(),titleId:ue(),descriptionId:ue(),open:x,onOpenChange:v,onOpenToggle:i.useCallback(()=>v(u=>!u),[v]),modal:c,children:s})};tt.displayName=Se;var st="DialogTrigger",Ls=i.forwardRef((t,n)=>{const{__scopeDialog:s,...r}=t,o=$(st,s),a=G(n,o.triggerRef);return e.jsx(V.button,{type:"button","aria-haspopup":"dialog","aria-expanded":o.open,"aria-controls":o.contentId,"data-state":ye(o.open),...r,ref:a,onClick:K(t.onClick,o.onOpenToggle)})});Ls.displayName=st;var we="DialogPortal",[Ws,nt]=et(we,{forceMount:void 0}),rt=t=>{const{__scopeDialog:n,forceMount:s,children:r,container:o}=t,a=$(we,n);return e.jsx(Ws,{scope:n,forceMount:s,children:i.Children.map(r,c=>e.jsx(be,{present:s||a.open,children:e.jsx(cs,{asChild:!0,container:o,children:c})}))})};rt.displayName=we;var le="DialogOverlay",at=i.forwardRef((t,n)=>{const s=nt(le,t.__scopeDialog),{forceMount:r=s.forceMount,...o}=t,a=$(le,t.__scopeDialog);return a.modal?e.jsx(be,{present:r||a.open,children:e.jsx(Ks,{...o,ref:n})}):null});at.displayName=le;var zs=ls("DialogOverlay.RemoveScroll"),Ks=i.forwardRef((t,n)=>{const{__scopeDialog:s,...r}=t,o=$(le,s);return e.jsx(Vt,{as:zs,allowPinchZoom:!0,shards:[o.contentRef],children:e.jsx(V.div,{"data-state":ye(o.open),...r,ref:n,style:{pointerEvents:"auto",...r.style}})})}),te="DialogContent",ot=i.forwardRef((t,n)=>{const s=nt(te,t.__scopeDialog),{forceMount:r=s.forceMount,...o}=t,a=$(te,t.__scopeDialog);return e.jsx(be,{present:r||a.open,children:a.modal?e.jsx($s,{...o,ref:n}):e.jsx(Vs,{...o,ref:n})})});ot.displayName=te;var $s=i.forwardRef((t,n)=>{const s=$(te,t.__scopeDialog),r=i.useRef(null),o=G(n,s.contentRef,r);return i.useEffect(()=>{const a=r.current;if(a)return Bt(a)},[]),e.jsx(it,{...t,ref:o,trapFocus:s.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:K(t.onCloseAutoFocus,a=>{var c;a.preventDefault(),(c=s.triggerRef.current)==null||c.focus()}),onPointerDownOutside:K(t.onPointerDownOutside,a=>{const c=a.detail.originalEvent,l=c.button===0&&c.ctrlKey===!0;(c.button===2||l)&&a.preventDefault()}),onFocusOutside:K(t.onFocusOutside,a=>a.preventDefault())})}),Vs=i.forwardRef((t,n)=>{const s=$(te,t.__scopeDialog),r=i.useRef(!1),o=i.useRef(!1);return e.jsx(it,{...t,ref:n,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:a=>{var c,l;(c=t.onCloseAutoFocus)==null||c.call(t,a),a.defaultPrevented||(r.current||(l=s.triggerRef.current)==null||l.focus(),a.preventDefault()),r.current=!1,o.current=!1},onInteractOutside:a=>{var d,x;(d=t.onInteractOutside)==null||d.call(t,a),a.defaultPrevented||(r.current=!0,a.detail.originalEvent.type==="pointerdown"&&(o.current=!0));const c=a.target;((x=s.triggerRef.current)==null?void 0:x.contains(c))&&a.preventDefault(),a.detail.originalEvent.type==="focusin"&&o.current&&a.preventDefault()}})}),it=i.forwardRef((t,n)=>{const{__scopeDialog:s,trapFocus:r,onOpenAutoFocus:o,onCloseAutoFocus:a,...c}=t,l=$(te,s),d=i.useRef(null),x=G(n,d);return Ut(),e.jsxs(e.Fragment,{children:[e.jsx(Ht,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:o,onUnmountAutoFocus:a,children:e.jsx(os,{role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":ye(l.open),...c,ref:x,onDismiss:()=>l.onOpenChange(!1)})}),e.jsxs(e.Fragment,{children:[e.jsx(Bs,{titleId:l.titleId}),e.jsx(Hs,{contentRef:d,descriptionId:l.descriptionId})]})]})}),je="DialogTitle",ct=i.forwardRef((t,n)=>{const{__scopeDialog:s,...r}=t,o=$(je,s);return e.jsx(V.h2,{id:o.titleId,...r,ref:n})});ct.displayName=je;var lt="DialogDescription",dt=i.forwardRef((t,n)=>{const{__scopeDialog:s,...r}=t,o=$(lt,s);return e.jsx(V.p,{id:o.descriptionId,...r,ref:n})});dt.displayName=lt;var ut="DialogClose",mt=i.forwardRef((t,n)=>{const{__scopeDialog:s,...r}=t,o=$(ut,s);return e.jsx(V.button,{type:"button",...r,ref:n,onClick:K(t.onClick,()=>o.onOpenChange(!1))})});mt.displayName=ut;function ye(t){return t?"open":"closed"}var ft="DialogTitleWarning",[yn,ht]=is(ft,{contentName:te,titleName:je,docsSlug:"dialog"}),Bs=({titleId:t})=>{const n=ht(ft),s=`\`${n.contentName}\` requires a \`${n.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${n.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${n.docsSlug}`;return i.useEffect(()=>{t&&(document.getElementById(t)||console.error(s))},[s,t]),null},Us="DialogDescriptionWarning",Hs=({contentRef:t,descriptionId:n})=>{const r=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${ht(Us).contentName}}.`;return i.useEffect(()=>{var a;const o=(a=t.current)==null?void 0:a.getAttribute("aria-describedby");n&&o&&(document.getElementById(n)||console.warn(r))},[r,t,n]),null},qs=tt,Gs=rt,pt=at,gt=ot,xt=ct,vt=dt,Ys=mt;const Qs=qs,Js=Gs,bt=i.forwardRef(({className:t,...n},s)=>e.jsx(pt,{ref:s,className:B("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",t),...n}));bt.displayName=pt.displayName;const _t=i.forwardRef(({className:t,children:n,...s},r)=>e.jsxs(Js,{children:[e.jsx(bt,{}),e.jsxs(gt,{ref:r,className:B("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",t),...s,children:[n,e.jsxs(Ys,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[e.jsx(es,{className:"h-4 w-4"}),e.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));_t.displayName=gt.displayName;const St=({className:t,...n})=>e.jsx("div",{className:B("flex flex-col space-y-1.5 text-center sm:text-left",t),...n});St.displayName="DialogHeader";const wt=({className:t,...n})=>e.jsx("div",{className:B("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",t),...n});wt.displayName="DialogFooter";const jt=i.forwardRef(({className:t,...n},s)=>e.jsx(xt,{ref:s,className:B("text-lg font-semibold leading-none tracking-tight",t),...n}));jt.displayName=xt.displayName;const yt=i.forwardRef(({className:t,...n},s)=>e.jsx(vt,{ref:s,className:B("text-sm text-muted-foreground",t),...n}));yt.displayName=vt.displayName;var Xs=Object.defineProperty,Zs=(t,n,s)=>n in t?Xs(t,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[n]=s,j=(t,n,s)=>Zs(t,typeof n!="symbol"?n+"":n,s);const en=["Init","Finished","Error","Canceled"],tn=["RequestingMedia","OpeningWebSocket","Running","FinishingProcessing"],sn=["OpeningWebSocket","Running","FinishingProcessing"];function nn(t){return en.includes(t)}function rn(t){return tn.includes(t)}function an(t){return sn.includes(t)}const on="wss://stt-rt.soniox.com/transcribe-websocket",ve=1e3,cn=120,Ee='{ "type": "finalize" }',ln=()=>({apiKey:"",bufferQueueSize:ve}),dn={echoCancellation:!1,noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:44100},Rt=class Nt{constructor(n){if(j(this,"_state","Init"),j(this,"_options"),j(this,"_audioOptions"),j(this,"_websocket"),j(this,"_mediaRecorder"),j(this,"_queuedMessages",[]),j(this,"_hasCallback",s=>{var r;return this._options[s]!=null||((r=this._audioOptions)==null?void 0:r[s])!=null}),j(this,"_callback",(s,...r)=>{var o,a,c,l;(a=(o=this._options)[s])==null||a.call(o,...r),(l=(c=this._audioOptions)==null?void 0:c[s])==null||l.call(c,...r)}),j(this,"start",async s=>{if(rn(this._state))throw new Error("SonioxClient is already active");this._audioOptions={...s};let r;if(s.stream!=null)r=s.stream.clone();else{this._setState("RequestingMedia");try{r=await navigator.mediaDevices.getUserMedia({audio:this._audioOptions.audioConstraints?this._audioOptions.audioConstraints:dn})}catch(o){this._onError("get_user_media_failed",o==null?void 0:o.toString())}}if(r==null)throw new Error("Failed to create stream");this._mediaRecorder=new MediaRecorder(r,s.mediaRecorderOptions?s.mediaRecorderOptions:{}),this._queuedMessages=[],this._mediaRecorder.addEventListener("dataavailable",this._onMediaRecorderData),this._mediaRecorder.addEventListener("error",this._onMediaRecorderError),this._mediaRecorder.addEventListener("pause",this._onMediaRecorderPause),this._mediaRecorder.addEventListener("stop",this._onMediaRecorderStop),this._mediaRecorder.start(cn),this._setState("OpeningWebSocket"),this._websocket=new WebSocket(this._options.webSocketUri??on),this._websocket.addEventListener("open",this._onWebSocketOpen),this._websocket.addEventListener("error",this._onWebSocketError),this._websocket.addEventListener("message",this._onWebSocketMessage)}),j(this,"stop",()=>{var s;this._state=="RequestingMedia"||this._state=="OpeningWebSocket"?(this._closeResources(),this._handleFinished()):this._state=="Running"&&(this._setState("FinishingProcessing"),this._closeSource(),(s=this._websocket)==null||s.send(""))}),j(this,"cancel",()=>{nn(this._state)||(this._closeResources(),this._setState("Canceled"))}),j(this,"finalize",()=>{var s;this._state=="RequestingMedia"||this._state=="OpeningWebSocket"?this._queuedMessages.length<(this._options.bufferQueueSize??ve)?this._queuedMessages.push(Ee):this._onError("queue_limit_exceeded","Queue size exceeded before websocket connection was established."):(this._state=="Running"||this._state=="FinishingProcessing")&&((s=this._websocket)==null||s.send(Ee))}),j(this,"_onMediaRecorderData",async s=>{var r;if(this._state==="OpeningWebSocket")this._queuedMessages.length<(this._options.bufferQueueSize??ve)?this._queuedMessages.push(s.data):this._onError("queue_limit_exceeded","Queue size exceeded before websocket connection was established.");else if(this._state==="Running"){const o=await s.data.arrayBuffer();(r=this._websocket)==null||r.send(o)}}),j(this,"_onMediaRecorderError",s=>{this._onError("media_recorder_error",s.error??"Unknown error")}),j(this,"_onMediaRecorderPause",s=>{this.stop()}),j(this,"_onMediaRecorderStop",s=>{this.stop()}),j(this,"_onWebSocketOpen",s=>{this._onWebSocketOpenAsync(s)}),j(this,"_onWebSocketOpenAsync",async s=>{var r,o;if(this._state!=="OpeningWebSocket"||this._audioOptions==null)return;const a=this._audioOptions;let c;if(typeof this._options.apiKey=="function")try{c=await this._options.apiKey()}catch(d){this._onError("api_key_fetch_failed",d==null?void 0:d.toString());return}else c=this._options.apiKey;if(this._state!=="OpeningWebSocket")return;const l={api_key:c,model:a.model,audio_format:a.audioFormat?a.audioFormat:"auto",sample_rate:a.sampleRate,num_channels:a.numChannels,language_hints:a.languageHints,context:a.context,enable_speaker_diarization:a.enableSpeakerDiarization,enable_language_identification:a.enableLanguageIdentification,enable_endpoint_detection:a.enableEndpointDetection,translation:a.translation,client_reference_id:a.clientReferenceId};(r=this._websocket)==null||r.send(JSON.stringify(l));for(const d of this._queuedMessages)(o=this._websocket)==null||o.send(d);this._queuedMessages=[],this._setState("Running"),this._callback("onStarted")}),j(this,"_onWebSocketError",s=>{an(this._state)&&this._onError("websocket_error","WebSocket error occurred.")}),j(this,"_onWebSocketMessage",s=>{if(this._state!="Running"&&this._state!="FinishingProcessing"||this._audioOptions==null)return;const r=JSON.parse(s.data);if(r.error_code!=null||r.error_message!=null){this._onError("api_error",r.error_message,r.error_code);return}this._callback("onPartialResult",r),r.finished&&this._handleFinished()}),j(this,"_onError",(s,r,o=void 0)=>{if(this._setState("Error"),this._closeResources(),this._hasCallback("onError"))this._callback("onError",s,r??"Unknown error",o);else throw new Error(`SonioxClient error: ${s}: ${r??"Unknown error"}`)}),j(this,"_closeSource",()=>{this._mediaRecorder!=null&&(this._mediaRecorder.removeEventListener("dataavailable",this._onMediaRecorderData),this._mediaRecorder.removeEventListener("error",this._onMediaRecorderError),this._mediaRecorder.removeEventListener("pause",this._onMediaRecorderPause),this._mediaRecorder.removeEventListener("stop",this._onMediaRecorderStop),this._mediaRecorder.stop(),this._mediaRecorder.stream.getTracks().forEach(s=>s.stop()),this._mediaRecorder=null)}),j(this,"_closeResources",()=>{this._queuedMessages=[],this._websocket!=null&&(this._websocket.removeEventListener("open",this._onWebSocketOpen),this._websocket.removeEventListener("error",this._onWebSocketError),this._websocket.removeEventListener("message",this._onWebSocketMessage),this._websocket.close(),this._websocket=null),this._closeSource()}),!Nt.isSupported)throw"Soniox Speech-to-Text is not supported on this browser.";this._options={...ln(),...n},this._audioOptions=null,this._websocket=null,this._mediaRecorder=null}_setState(n){const s=this._state;this._state=n,this._callback("onStateChange",{oldState:s,newState:n})}get state(){return this._state}_handleFinished(){this._closeResources(),this._setState("Finished"),this._callback("onFinished")}};j(Rt,"isSupported",!!("WebSocket"in window&&navigator.mediaDevices&&navigator.mediaDevices.getUserMedia));let un=Rt;function mn({selectedLanguage:t}){const[n,s]=i.useState(!1),[r,o]=i.useState(!1),[a,c]=i.useState([]),[l,d]=i.useState([]),[x,v]=i.useState("idle"),[u,p]=i.useState(0),[h,_]=i.useState(!1),[b,m]=i.useState(""),[S,z]=i.useState(""),[C,y]=i.useState(50),[P,T]=i.useState(5),D=i.useRef(null),L=i.useRef(new Map),O=i.useRef([]),M=i.useRef(null),R=i.useRef(null),I=i.useRef(0),W=i.useRef(null),se=i.useRef(0);i.useRef(null);const{toast:U}=Ie();i.useEffect(()=>()=>{D.current&&D.current.cancel(),M.current&&clearTimeout(M.current)},[]);const Y=()=>t==="auto"?["en","es","fr","de","pt","hi","zh","ja","ko"]:[t],q=g=>{const w=[];let f=null,A="",N="";for(const E of g){if(!E.is_final)continue;const k=E.speaker||"1",F=k.startsWith("SPEAKER")?k:`SPEAKER ${k}`;A!==F?(f&&w.push(f),A=F,N=E.text,f={speaker:F,text:E.text,startTime:(E.start_ms||0)/1e3,endTime:(E.end_ms||0)/1e3,language:E.language||"en"}):(N+=E.text,f&&(f.text=N,f.endTime=(E.end_ms||0)/1e3))}return f&&w.push(f),w},H=async()=>{try{const g=S?S.split(",").map(N=>N.trim()).filter(N=>N.length>0):void 0,w={dominanceThreshold:C/100,silenceThreshold:P/100},f=await fetch("/api/transcripts",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({title:`Live Recording ${new Date().toLocaleString()}`,language:t,topicPrompt:b||void 0,topicKeywords:g,participationConfig:w})});if(!f.ok)throw new Error("Failed to create draft transcript");return(await f.json()).id}catch(g){return console.error("Failed to create draft transcript:",g),null}},ae=async()=>{var A;const g=R.current;if(!g)return;const w=3,f=100;for(let N=0;N<=w;N++)try{v("saving");const E=I.current,F=O.current.slice(E);if(F.length===0){v("saved");return}const Q=await fetch(`/api/transcripts/${g}/segments`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({segments:F,fromIndex:E})});if(!Q.ok){if(Q.status===409&&N<w){const X=await Q.json();console.warn(`Cursor mismatch (attempt ${N+1}/${w+1}):`,X.error);const Re=(A=X.error)==null?void 0:A.match(/got (\d+)/);if(Re){I.current=parseInt(Re[1],10);const It=f*Math.pow(2,N);await new Promise(Ot=>setTimeout(Ot,It));continue}}throw new Error(`Failed to append segments: ${Q.status}`)}const J=await Q.json();I.current=J.lastSegmentIdx||E+F.length,J.newFlaggedItems&&J.newFlaggedItems.length>0&&p(X=>X+J.newFlaggedItems.length),v("saved"),se.current=Date.now();return}catch(E){if(console.error(`Append failed (attempt ${N+1}/${w+1}):`,E),N===w){v("error");return}const k=f*Math.pow(2,N);await new Promise(F=>setTimeout(F,k))}},kt=async()=>{var w;const g=R.current;if(g)try{const f=O.current,A=((w=f[f.length-1])==null?void 0:w.endTime)||0;if(!(await fetch(`/api/transcripts/${g}/complete`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({duration:A})})).ok)throw new Error("Failed to complete transcript");U({title:"Recording saved",description:u>0?`Saved with ${u} flagged item(s)`:"Transcript saved successfully"})}catch(f){console.error("Failed to complete transcript:",f),U({title:"Failed to complete",description:"Transcript may be incomplete",variant:"destructive"})}},Ct=async()=>{if(W.current||!R.current)return;const w=O.current.slice(I.current),f=5,A=3e3,N=Date.now()-se.current;if(w.length>=f||w.length>0&&N>=A){const k=ae();W.current=k,await k,W.current=null}},Et=()=>{_(!0)},Dt=async()=>{try{o(!0),_(!1);let g;if(!g)try{const f=await fetch("/api/get-temp-api-key",{method:"POST"});f.ok?g=(await f.json()).apiKey:console.error("Failed to get temporary API key:",f.status,f.statusText)}catch(f){console.error("Failed to fetch temporary API key:",f)}if(!g)throw new Error("No Soniox API key available. Please set VITE_SONIOX_API_KEY environment variable or implement /api/get-temp-api-key endpoint.");const w=new un({apiKey:g,bufferQueueSize:1e3});D.current=w,M.current&&(clearTimeout(M.current),M.current=null),L.current.clear(),c([]),O.current=[],d([]),p(0),v("idle"),I.current=0,se.current=Date.now(),await w.start({model:"stt-rt-preview",languageHints:Y(),enableSpeakerDiarization:!0,enableLanguageIdentification:t==="auto",enableEndpointDetection:!0,onPartialResult:f=>{if(console.log("Partial result:",f),f.tokens&&f.tokens.length>0){f.tokens.forEach(k=>{const F=k.start_ms??0,Q=k.end_ms??0,J=`${F}_${Q}`,X=L.current.get(J);(!X||k.is_final||!X.is_final)&&L.current.set(J,k)});const A=f.tokens.filter(k=>!k.is_final);d(A);const N=Array.from(L.current.values()).filter(k=>k.is_final).sort((k,F)=>(k.start_ms||0)-(F.start_ms||0)),E=q(N);O.current=E,c(E),Ct()}},onStarted:async()=>{console.log("Recording started"),s(!0),o(!1);const f=await H();f?(R.current=f,console.log("Draft transcript created:",f)):U({title:"Warning",description:"Failed to create draft transcript. Recording will not be auto-saved.",variant:"destructive"})},onFinished:async()=>{console.log("Recording finished"),s(!1),d([]),R.current&&O.current.length>0&&(W.current&&await W.current,O.current.length>I.current&&await ae(),await kt(),M.current=setTimeout(()=>{c([]),O.current=[],L.current.clear(),R.current=null,I.current=0,p(0),v("idle"),M.current=null},2e3))},onError:f=>{console.error("Recording error:",f),s(!1),o(!1),U({title:"Recording error",description:f.message||"Failed to record audio",variant:"destructive"})}})}catch(g){console.error("Failed to start recording:",g),o(!1),s(!1),U({title:"Failed to start recording",description:g instanceof Error?g.message:"Please check your API key configuration",variant:"destructive"})}},Pt=async()=>{D.current&&(await D.current.stop(),d([]))},Tt=()=>{c([]),O.current=[],d([]),L.current.clear()},Mt=()=>{if(l.length===0)return null;const g=l.map(w=>w.text).join("");return e.jsx(ee,{className:"p-4 bg-muted/50 border-dashed",children:e.jsx("p",{className:"text-sm text-muted-foreground italic",children:g})})};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:!n&&!r?e.jsxs(Z,{onClick:Et,size:"default","data-testid":"button-start-recording",className:"gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Start Recording"]}):e.jsx(Z,{onClick:Pt,variant:"destructive",size:"default","data-testid":"button-stop-recording",disabled:r,className:"gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx(he,{className:"h-4 w-4 animate-spin"}),"Initializing..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-4 w-4"}),"Stop Recording"]})})}),a.length>0&&!n&&e.jsx(Z,{onClick:Tt,variant:"outline",size:"sm","data-testid":"button-clear-transcript",children:"Clear Transcript"})]}),n&&e.jsx(ee,{className:"p-3 bg-destructive/10 border-destructive/50",children:e.jsxs("div",{className:"flex items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-destructive animate-pulse"}),e.jsx("p",{className:"text-sm font-medium",children:"Recording in progress..."})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[x==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-muted-foreground","data-testid":"status-saving",children:[e.jsx(he,{className:"h-3 w-3 animate-spin"}),e.jsx("span",{children:"Saving..."})]}),x==="saved"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-green-600 dark:text-green-400","data-testid":"status-saved",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-green-600 dark:bg-green-400"}),e.jsx("span",{children:"Saved"})]}),x==="error"&&e.jsxs("div",{className:"flex items-center gap-2 text-xs text-destructive","data-testid":"status-error",children:[e.jsx("div",{className:"h-2 w-2 rounded-full bg-destructive"}),e.jsx("span",{children:"Save error"})]}),u>0&&e.jsx("div",{className:"flex items-center gap-2 text-xs text-amber-600 dark:text-amber-400","data-testid":"status-profanity",children:e.jsxs("span",{className:"font-medium",children:[u," flagged"]})})]})]})}),e.jsxs("div",{className:"space-y-3",children:[a.map((g,w)=>e.jsx(De,{segment:g,isActive:!1,onClick:()=>{},speakerColor:qt(g.speaker)},w)),Mt()]}),a.length===0&&!n&&e.jsxs(ee,{className:"p-8 text-center",children:[e.jsx(fe,{className:"h-12 w-12 mx-auto mb-3 text-muted-foreground"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:'Click "Start Recording" to begin live transcription'})]}),e.jsx(Qs,{open:h,onOpenChange:_,children:e.jsxs(_t,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsxs(St,{children:[e.jsxs(jt,{className:"flex items-center gap-2",children:[e.jsx(ss,{className:"h-5 w-5"}),"Session Configuration (Optional)"]}),e.jsx(yt,{children:"Configure topic and participation settings for this recording session. Leave blank to use defaults."})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Topic Configuration"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"topic-prompt",children:"Discussion Prompt/Question"}),e.jsx(Ze,{id:"topic-prompt",placeholder:"e.g., 'Discuss the causes of climate change'",value:b,onChange:g=>m(g.target.value),rows:3}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"The main question or topic for this discussion"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"topic-keywords",children:"Topic Keywords (comma-separated)"}),e.jsx(ce,{id:"topic-keywords",placeholder:"e.g., climate, environment, carbon, emissions",value:S,onChange:g=>z(g.target.value)}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Keywords that indicate the discussion is on-topic"})]})]}),e.jsx("div",{className:"border-t pt-4"}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("h3",{className:"font-semibold text-sm",children:"Participation Thresholds"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"dominance-threshold",children:"Dominance Threshold (%)"}),e.jsx(ce,{id:"dominance-threshold",type:"number",min:"0",max:"100",value:C,onChange:g=>y(Number(g.target.value))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Flag if one speaker exceeds this percentage (default: 50%)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(ne,{htmlFor:"silence-threshold",children:"Silence Threshold (%)"}),e.jsx(ce,{id:"silence-threshold",type:"number",min:"0",max:"100",value:P,onChange:g=>T(Number(g.target.value))}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Flag if speaker is below this percentage (default: 5%)"})]})]})]})]}),e.jsxs(wt,{children:[e.jsx(Z,{variant:"outline",onClick:()=>{_(!1),m(""),z(""),y(50),T(5)},children:"Skip"}),e.jsx(Z,{onClick:Dt,children:"Start Recording"})]})]})})]})}function Rn(){const[t,n]=i.useState(null),[s,r]=i.useState(null),[o,a]=i.useState(0),[c,l]=i.useState(null),[d,x]=i.useState(!1),[v,u]=i.useState("en"),{toast:p}=Ie(),h=async P=>{n(P);const T=URL.createObjectURL(P);r(T),x(!0);try{const D=new FormData;D.append("audio",P),D.append("language",v);const L=await fetch("/api/upload-audio",{method:"POST",body:D});if(!L.ok){const M=await L.json();throw new Error(M.error||"Failed to upload audio")}const O=await L.json();l(O.id),p({title:"Audio uploaded",description:"Transcription is being processed..."})}catch(D){console.error("Upload error:",D),p({title:"Upload failed",description:D instanceof Error?D.message:"Failed to upload audio file",variant:"destructive"}),_()}finally{x(!1)}},_=()=>{s&&URL.revokeObjectURL(s),n(null),r(null),a(0),l(null)},b=P=>{a(P.startTime)},{data:m,isLoading:S}=At({queryKey:["/api/transcription",c],enabled:!!c,refetchInterval:P=>{const T=P.state.data;return(T==null?void 0:T.status)==="completed"||(T==null?void 0:T.status)==="error"?!1:2e3}});i.useEffect(()=>{(m==null?void 0:m.status)==="completed"?p({title:"Transcription complete",description:"Your audio has been successfully transcribed"}):(m==null?void 0:m.status)==="error"&&p({title:"Transcription failed",description:"An error occurred while processing your audio",variant:"destructive"})},[m==null?void 0:m.status,p]);const z=(m==null?void 0:m.segments)||[],C=(m==null?void 0:m.languages)||[],y=d||c&&(m==null?void 0:m.status)==="processing";return e.jsx("div",{className:"min-h-screen bg-background p-6",children:e.jsxs("div",{className:"max-w-6xl mx-auto space-y-6",children:[e.jsxs("header",{children:[e.jsx("h1",{className:"text-2xl font-semibold mb-2",children:"Audio Transcript Viewer"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Upload an audio file or record live audio for real-time transcription with speaker diarization"})]}),e.jsxs(Gt,{defaultValue:"upload",className:"w-full",children:[e.jsxs(Yt,{className:"grid w-full max-w-md grid-cols-2","data-testid":"tabs-mode",children:[e.jsxs(Ne,{value:"upload","data-testid":"tab-upload",className:"gap-2",children:[e.jsx(Pe,{className:"h-4 w-4"}),"Upload File"]}),e.jsxs(Ne,{value:"live","data-testid":"tab-live",className:"gap-2",children:[e.jsx(fe,{className:"h-4 w-4"}),"Live Recording"]})]}),e.jsx(ke,{value:"upload",className:"mt-6",children:e.jsxs("div",{className:"grid lg:grid-cols-[350px,1fr] gap-6",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium mb-3",children:"Audio Input"}),e.jsx(ms,{onFileSelect:h,selectedFile:t,onRemoveFile:_})]}),!t&&e.jsx(Ce,{value:v,onChange:u}),y&&e.jsxs("div",{className:"flex items-center gap-2 p-3 bg-muted rounded-lg",children:[e.jsx(he,{className:"h-4 w-4 animate-spin text-primary"}),e.jsx("span",{className:"text-sm text-muted-foreground",children:d?"Uploading...":"Processing transcription..."})]}),s&&!y&&e.jsx("div",{children:e.jsx(Ps,{audioUrl:s,onTimeUpdate:a,onDelete:_})})]}),e.jsx("div",{className:"h-[calc(100vh-12rem)]",children:e.jsx(Ms,{segments:z,currentTime:o,onSegmentClick:b,languages:C})})]})}),e.jsx(ke,{value:"live",className:"mt-6",children:e.jsxs("div",{className:"grid lg:grid-cols-[350px,1fr] gap-6",children:[e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h2",{className:"text-sm font-medium mb-3",children:"Live Recording"}),e.jsx(Ce,{value:v,onChange:u})]})}),e.jsx("div",{className:"h-[calc(100vh-12rem)]",children:e.jsx(mn,{selectedLanguage:v})})]})})]})]})})}export{Rn as default};
